name: Test Vector Store (Altered)

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Call OpenAI Responses API (File Search)
        shell: bash
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          VECTOR_STORE_ID: ${{ secrets.OPENAI_VECTOR_STORE_ID }}   # oder vorübergehend direkt vs_... eintragen
        run: |
          set -euo pipefail

          echo "Calling OpenAI Responses API with File Search…"
          RESP=$(curl -sS https://api.openai.com/v1/responses \
            -H "Authorization: Bearer ${OPENAI_API_KEY}" \
            -H "Content-Type: application/json" \
            -d @- <<EOF
          {
            "model": "gpt-4.1-mini",
            "input": [
              {
                "role": "user",
                "content": "Bitte nenne die Constructed-Deckregeln von Altered kurz auf Deutsch."
              }
            ],
            "tools": [
              { "type": "file_search" }
            ],
            "attachments": [
              { "vector_store_id": "${VECTOR_STORE_ID}" }
            ]
          }
EOF
          )

          echo "Raw JSON response:"
          echo "$RESP"

          # OUTPUT_TEXT extrahieren
          export RESP_JSON="$RESP"
          python - <<'PY'
import os, json
data = json.loads(os.environ.get("RESP_JSON","{}"))
print("\n=== OUTPUT_TEXT ===\n")
print(data.get("output_text") or data)
PY
